<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ADMIN Â· SUPPLY CHAIN AUCTION SHOW</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & ROOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --blue:#1E90FF;
  --blue-mid:#3FA9F5;
  --blue-light:#00BFFF;
  --blue-pale:#EBF5FF;
  --blue-dim:#D6EEFF;
  --gold:#F5C542;
  --gold-deep:#E6B800;
  --white:#FFFFFF;
  --gray-bg:#F7F9FC;
  --gray-border:#E2EAF3;
  --gray-mid:#9AAFC7;
  --gray-dark:#5A7490;
  --black:#111111;
  --text:#1A2B42;
  --green:#22c55e;
  --red:#ef4444;
  --shadow-sm:0 1px 4px rgba(30,80,140,.07);
  --shadow-md:0 4px 16px rgba(30,80,140,.1);
  --radius:8px;
}
html,body{width:100%;min-height:100vh;background:var(--gray-bg);color:var(--text);font-family:'Plus Jakarta Sans',sans-serif}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHASE BAR & NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#phasebar{position:fixed;top:0;left:0;right:0;height:3px;z-index:999;transition:background 1s;background:var(--blue)}
#notif{position:fixed;top:20px;right:20px;z-index:9999;padding:10px 18px;border-radius:var(--radius);min-width:180px;font-size:12px;font-weight:700;letter-spacing:.5px;transform:translateX(150%);transition:transform .3s;pointer-events:none;background:var(--blue-pale);border:1px solid var(--blue);color:var(--blue)}
#notif.show{transform:translateX(0)}
#notif.ok{background:rgba(34,197,94,.08);border-color:var(--green);color:#16a34a}
#notif.err{background:rgba(239,68,68,.08);border-color:var(--red);color:#dc2626}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 20px;border:none;border-radius:var(--radius);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-weight:700;font-size:12px;letter-spacing:.3px;transition:all .2s;position:relative;overflow:hidden}
.btn:hover{transform:translateY(-1px)}
.btn:active{transform:scale(.97)!important}
.btn-gold{background:var(--gold);color:var(--black);box-shadow:0 2px 8px rgba(245,197,36,.3)}
.btn-gold:hover{background:#f0be30;box-shadow:0 4px 16px rgba(245,197,36,.4)}
.btn-blue{background:var(--blue);color:#fff;box-shadow:0 2px 8px rgba(30,144,255,.25)}
.btn-blue:hover{background:#1a7de8;box-shadow:0 4px 16px rgba(30,144,255,.35)}
.btn-outline{background:#fff;color:var(--blue);border:1.5px solid var(--blue)}
.btn-outline:hover{background:var(--blue-pale)}
.btn-green{background:var(--green);color:#fff;box-shadow:0 2px 8px rgba(34,197,94,.2)}
.btn-green:hover{background:#16a34a}
.btn-red{background:var(--red);color:#fff;box-shadow:0 2px 8px rgba(239,68,68,.2)}
.btn-red:hover{background:#dc2626}
.btn-ghost{background:transparent;color:var(--gray-dark);border:1px solid var(--gray-border)}
.btn-ghost:hover{background:var(--gray-bg);color:var(--text)}
.btn-sm{padding:7px 14px;font-size:11px}
.btn-lg{padding:14px 36px;font-size:14px}
.btn:disabled{opacity:.35;cursor:not-allowed;transform:none!important;box-shadow:none!important}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM ELEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.inp{background:#fff;border:1.5px solid var(--gray-border);border-radius:var(--radius);padding:9px 12px;color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:500;width:100%;outline:none;transition:.2s}
.inp:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(30,144,255,.1)}
.inp::placeholder{color:var(--gray-mid)}
.lbl{display:block;font-size:10px;font-weight:700;letter-spacing:2px;color:var(--gray-dark);text-transform:uppercase;margin-bottom:5px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--blue-pale) 0%,var(--gray-bg) 100%)}
.lcard{width:min(400px,92vw);background:#fff;border:1px solid var(--gray-border);border-radius:12px;padding:44px 36px;text-align:center;box-shadow:var(--shadow-md)}
.l-eyebrow{font-size:10px;font-weight:700;letter-spacing:4px;color:var(--gray-mid);margin-bottom:12px;text-transform:uppercase}
.l-title{font-size:44px;font-weight:800;color:var(--black);letter-spacing:-1px;margin-bottom:4px}
.l-sub{font-size:12px;font-weight:600;letter-spacing:2px;color:var(--blue);margin-bottom:32px;text-transform:uppercase}
.l-err{color:var(--red);font-size:12px;font-weight:600;margin-top:10px;min-height:16px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#admin{display:none}

/* Header */
.a-hdr{background:#fff;border-bottom:1px solid var(--gray-border);padding:0 24px;position:sticky;top:3px;z-index:200;display:flex;align-items:center;gap:12px;height:56px;box-shadow:var(--shadow-sm)}
.a-logo{font-size:16px;font-weight:800;color:var(--black);letter-spacing:-.3px}
.phase-badge{display:inline-flex;align-items:center;gap:7px;padding:4px 12px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:1.5px;background:var(--blue-pale);border:1px solid rgba(30,144,255,.25);color:var(--blue);text-transform:uppercase;transition:all .3s}
.pdot{width:7px;height:7px;border-radius:50%;background:var(--blue);animation:pdot 1.5s ease-in-out infinite}
@keyframes pdot{0%,100%{opacity:1}50%{opacity:.3}}

/* Body Grid */
.a-body{display:grid;grid-template-columns:260px 1fr;min-height:calc(100vh - 59px)}
@media(max-width:900px){.a-body{grid-template-columns:1fr}}

/* Sidebar */
.aside{padding:16px 14px;background:#fff;border-right:1px solid var(--gray-border);display:flex;flex-direction:column;gap:10px;overflow-y:auto;max-height:calc(100vh - 59px);position:sticky;top:59px}
.amain{padding:22px 24px;overflow-y:auto;background:var(--gray-bg)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sc{background:#fff;border:1px solid var(--gray-border);border-radius:var(--radius);padding:14px}
.sc-ttl{font-size:9px;font-weight:700;letter-spacing:2.5px;color:var(--gray-mid);text-transform:uppercase;margin-bottom:10px}

/* Timer big */
.tbig{font-family:'DM Mono',monospace;font-weight:500;font-size:52px;text-align:center;color:var(--blue);line-height:1}
.tbig.warn{color:var(--gold-deep)}
.tbig.dang{color:var(--red);animation:tpulse .35s ease-in-out infinite}
@keyframes tpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}

/* Leaderboard rows */
.lbr{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:6px;margin-bottom:3px;background:var(--gray-bg);transition:.25s;font-size:13px;font-weight:600}
.lbr.at{background:var(--blue-pale);border:1px solid rgba(30,144,255,.2);color:var(--blue)}
.lbr:first-child:not(.at){background:rgba(245,197,36,.06);border:1px solid rgba(245,197,36,.2)}

/* Bet rows */
.betr{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;border-radius:6px;margin-bottom:3px;background:var(--gray-bg);font-size:13px;font-weight:600;transition:.25s}
.betr.hb{background:rgba(245,197,36,.06);border:1px solid rgba(245,197,36,.2)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs{display:flex;gap:2px;background:var(--gray-bg);padding:4px;border-radius:var(--radius);margin-bottom:22px;flex-wrap:wrap;border:1px solid var(--gray-border)}
.tab{padding:9px 18px;border:none;border-radius:6px;background:transparent;color:var(--gray-dark);cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:700;letter-spacing:.3px;transition:.2s}
.tab.on{background:#fff;color:var(--blue);box-shadow:var(--shadow-sm)}
.tab:hover:not(.on){color:var(--text);background:rgba(255,255,255,.5)}
.tabp{display:none;animation:tpf .25s ease}
.tabp.on{display:block}
@keyframes tpf{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARD SECTIONS (content area)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mc{background:#fff;border:1px solid var(--gray-border);border-radius:var(--radius);padding:18px;margin-bottom:14px;box-shadow:var(--shadow-sm)}
.mc-ttl{font-size:9px;font-weight:700;letter-spacing:2.5px;color:var(--blue);text-transform:uppercase;margin-bottom:14px}
.trow{display:flex;gap:8px;align-items:center;margin-bottom:8px}

/* Question cards */
.qcard{background:#fff;border:1.5px solid var(--gray-border);border-radius:var(--radius);padding:14px;margin-bottom:8px;transition:.2s}
.qcard:hover{border-color:var(--blue-mid);box-shadow:var(--shadow-sm)}
.qcard.sel{border-color:var(--blue);background:var(--blue-pale)}
.qhdr{display:flex;align-items:flex-start;gap:10px}
.qnl{font-family:'DM Mono',monospace;font-size:10px;color:var(--blue);font-weight:500;min-width:28px;margin-top:2px}
.qtext{flex:1;font-size:14px;font-weight:600;line-height:1.4;color:var(--text)}
.qbody{overflow:hidden;max-height:0;transition:max-height .4s}
.qbody.open{max-height:700px;margin-top:12px}
.qorow{display:flex;gap:8px;align-items:center;margin-bottom:7px}
.cdot{width:22px;height:22px;border-radius:50%;border:2px solid var(--gray-border);cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:11px;transition:.2s;background:#fff}
.cdot.on{background:var(--green);border-color:var(--green);color:#fff}

/* Team activate buttons */
.act-btn{display:flex;align-items:center;justify-content:space-between;width:100%;padding:10px 12px;border-radius:var(--radius);border:1.5px solid var(--gray-border);background:#fff;cursor:pointer;color:var(--text);font-family:'Plus Jakarta Sans',sans-serif;transition:.2s;margin-bottom:6px;text-align:left}
.act-btn:hover{background:var(--blue-pale);border-color:var(--blue)}
.act-btn.on{background:var(--blue-pale);border-color:var(--blue);color:var(--blue)}

/* Flow steps */
.flow{display:flex;align-items:center;gap:6px;flex-wrap:wrap;padding:10px 12px;background:var(--gray-bg);border-radius:var(--radius);margin-bottom:14px;border:1px solid var(--gray-border)}
.fstep{padding:4px 10px;border-radius:4px;white-space:nowrap;font-size:10px;font-weight:700;letter-spacing:.5px}
.farrow{color:var(--gray-mid);font-size:12px}

/* Answer box */
.ans-box{padding:12px 14px;border-radius:var(--radius);background:var(--gray-bg);border:1.5px solid var(--gray-border);font-size:15px;font-weight:600;min-height:50px;display:flex;align-items:center;transition:.3s;margin-bottom:12px;color:var(--text)}

/* Grid */
.cgrid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:800px){.cgrid{grid-template-columns:1fr}}

/* Section headings */
.s-head{font-size:28px;font-weight:800;color:var(--black);letter-spacing:-1px;margin-bottom:20px}

/* Footer */
.a-foot{padding:10px 24px;background:#fff;border-top:1px solid var(--gray-border);display:flex;align-items:center;gap:12px;flex-wrap:wrap;position:sticky;bottom:0;z-index:100}
</style>
</head>
<body>
<div id="phasebar"></div>
<div id="notif"></div>
<div id="app">

<!-- â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â• -->
<div id="login">
  <div class="lcard">
    <div class="l-eyebrow">Master Control Panel</div>
    <div class="l-title">Admin</div>
    <div class="l-sub">SUPPLY CHAIN Auction Show</div>
    <label class="lbl" style="margin-bottom:6px;text-align:left">Password</label>
    <input class="inp" type="password" id="pw" placeholder="Enter password" style="margin-bottom:16px;text-align:center;letter-spacing:4px">
    <button class="btn btn-blue btn-lg" style="width:100%" id="L_btn">ğŸ”“ Access Panel</button>
    <div class="l-err" id="lerr"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ADMIN PANEL â•â•â•â•â•â•â•â•â•â• -->
<div id="admin">

  <!-- Header -->
  <div class="a-hdr">
    <div class="a-logo">âš“  SUPPLY CHAIN Auction Show</div>
    <div style="width:1px;height:20px;background:var(--gray-border)"></div>
    <div class="phase-badge" id="phase-badge"><div class="pdot" id="pdot"></div><span id="phase-lbl">LOBBY</span></div>
    <div style="flex:1"></div>
    <button class="btn btn-outline btn-sm" id="A_display">ğŸ“º Display</button>
    <button class="btn btn-red btn-sm" id="A_reset">â†º Reset</button>
  </div>

  <div class="a-body">

    <!-- â•â• SIDEBAR â•â• -->
    <div class="aside">
      <div class="sc">
        <div class="sc-ttl">â± Live Timer</div>
        <div class="tbig" id="S_timer">--</div>
        <div style="text-align:center;margin-top:6px;font-size:9px;font-weight:700;letter-spacing:2px;color:var(--gray-mid);text-transform:uppercase" id="S_tstatus">Stopped</div>
      </div>
      <div class="sc">
        <div class="sc-ttl" style="color:var(--blue)">ğŸ† Leaderboard</div>
        <div id="S_lb"></div>
      </div>
      <div class="sc">
        <div class="sc-ttl" style="color:var(--gold-deep)">ğŸ’° Live Bets</div>
        <div id="S_bets"></div>
      </div>
      <div class="sc">
        <div class="sc-ttl">â“ Active Question</div>
        <div id="S_q" style="font-size:12px;font-weight:600;line-height:1.5;color:var(--gray-dark)">None selected</div>
      </div>
    </div>

    <!-- â•â• MAIN CONTENT â•â• -->
    <div class="amain">
      <div class="tabs">
        <button class="tab on" data-t="setup">âš™ Setup</button>
        <button class="tab" data-t="questions">â“ Questions</button>
        <button class="tab" data-t="live">ğŸ¬ Live</button>
        <button class="tab" data-t="broadcast">ğŸ“¢ Broadcast</button>
      </div>

      <!-- SETUP TAB -->
      <div id="tabp-setup" class="tabp on">
        <div class="s-head">Pre-Show Setup</div>
        <div class="mc">
          <div class="mc-ttl">Team Configuration</div>
          <div style="display:flex;gap:10px;align-items:flex-end;margin-bottom:14px;flex-wrap:wrap">
            <div><label class="lbl">Team Count (2â€“10)</label><input class="inp" type="number" id="teamCount" min="2" max="10" value="4" style="width:80px"></div>
            <button class="btn btn-blue btn-sm" id="A_gen">Generate</button>
          </div>
          <div id="teamInputs"></div>
          <div style="display:flex;gap:10px;align-items:flex-end;margin-top:10px;flex-wrap:wrap">
            <div style="flex:1;min-width:160px"><label class="lbl">Set All Money To</label><input class="inp" type="number" id="allMoney" value="10000"></div>
            <button class="btn btn-outline btn-sm" id="A_allMoney">Apply</button>
          </div>
        </div>
        <div class="mc">
          <div class="mc-ttl">Timer Default (5â€“120s)</div>
          <div style="display:flex;gap:10px;align-items:center">
            <input class="inp" type="number" id="timerDef" min="5" max="120" value="30" style="width:90px">
            <span style="font-size:13px;font-weight:500;color:var(--gray-dark)">seconds per question</span>
          </div>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px">
          <button class="btn btn-green" id="A_save">ğŸ’¾ Save Config</button>
        </div>
        <div id="setupMsg" style="font-size:11px;font-weight:600;letter-spacing:1px;min-height:18px;margin-bottom:20px"></div>
        <div class="mc" style="border-color:rgba(245,197,36,.35);background:rgba(245,197,36,.03)">
          <div class="mc-ttl" style="color:var(--gold-deep)">Launch Sequence</div>
          <p style="font-size:14px;font-weight:500;color:var(--gray-dark);margin-bottom:16px;line-height:1.6">Save config first, then START. Teams open <strong style="color:var(--blue)">Betting</strong> to spin and join.</p>
          <button class="btn btn-gold btn-lg" id="A_start">â–¶ Start Live Show</button>
        </div>
      </div>

      <!-- QUESTIONS TAB -->
      <div id="tabp-questions" class="tabp">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:22px;flex-wrap:wrap;gap:10px">
          <div class="s-head" style="margin-bottom:0">Question Bank</div>
          <button class="btn btn-blue btn-sm" id="A_addQ">+ Add Question</button>
        </div>
        <div id="qBank"></div>
      </div>

      <!-- LIVE TAB -->
      <div id="tabp-live" class="tabp">
        <div class="s-head">Live Control</div>
        <div class="flow">
          <div class="fstep" style="background:var(--blue-pale);color:var(--blue)">1 Select Q</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(245,197,36,.1);color:var(--gold-deep)">2 Open Betting</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:var(--gray-bg);color:var(--gray-dark)">3 Teams Bet</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(239,68,68,.08);color:var(--red)">4 Close &amp; Reveal</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:rgba(34,197,94,.08);color:#16a34a">5 Activate + Timer</div><div class="farrow">â†’</div>
          <div class="fstep" style="background:var(--gray-bg);color:var(--gray-dark)">6 Judge</div>
        </div>
        <div class="cgrid">
          <div class="mc">
            <div class="mc-ttl">Step 1 Â· Select Question</div>
            <select class="inp" id="qSelect" style="margin-bottom:10px"><option value="-1">â€” Choose question â€”</option></select>
            <button class="btn btn-blue btn-sm" id="A_setQ">ğŸ“Œ Set Question</button>
          </div>
          <div class="mc" style="border-color:rgba(245,197,36,.3)">
            <div class="mc-ttl" style="color:var(--gold-deep)">Step 2 Â· Betting</div>
            <p style="font-size:13px;font-weight:500;color:var(--gray-dark);margin-bottom:12px;line-height:1.5">Teams see <strong style="color:var(--gold-deep)">question text only</strong> â€” options hidden until you close betting.</p>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-gold" id="A_openBet">ğŸ’° Open Betting</button>
              <button class="btn btn-red" id="A_closeBet">ğŸ”’ Close &amp; Reveal</button>
            </div>
          </div>
          <div class="mc" style="border-color:rgba(30,144,255,.2)">
            <div class="mc-ttl">Step 3 Â· Timer</div>
            <input class="inp" type="number" id="timerOvr" placeholder="Override seconds (blank = default)" style="margin-bottom:12px">
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="btn btn-green btn-sm" id="A_timerStart">â–¶ Start</button>
              <button class="btn btn-red btn-sm" id="A_timerStop">â¹ Stop</button>
              <button class="btn btn-outline btn-sm" id="A_timerReset">â†º Reset</button>
            </div>
          </div>
          <div class="mc" style="border-color:rgba(34,197,94,.2)">
            <div class="mc-ttl" style="color:#16a34a">Step 3 Â· Activate Team</div>
            <div id="teamActList"></div>
          </div>
        </div>
        <div class="mc" style="border-color:rgba(239,68,68,.2)">
          <div class="mc-ttl" style="color:var(--red)">Step 4 Â· Judge Answer</div>
          <div class="ans-box" id="ansDisplay">â³ Waiting for team answer...</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-green" id="A_correct" disabled>âœ… Correct â€” Award Bet</button>
            <button class="btn btn-red" id="A_wrong" disabled>âŒ Wrong â€” Deduct Bet</button>
          </div>
        </div>
        <div class="mc">
          <div class="mc-ttl">Game Flow</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn btn-blue" id="A_nextQ">â­ Next Question</button>
            <button class="btn btn-gold btn-lg" id="A_endGame">ğŸ† End Show &amp; Reveal Winner</button>
          </div>
        </div>
      </div>

      <!-- BROADCAST TAB -->
      <div id="tabp-broadcast" class="tabp">
        <div class="s-head">Broadcast</div>
        <div class="mc">
          <div class="mc-ttl">Announcement to All Screens</div>
          <textarea class="inp" id="annInput" rows="3" placeholder="Type announcement..." style="margin-bottom:12px;resize:vertical"></textarea>
          <div style="display:flex;gap:8px">
            <button class="btn btn-gold" id="A_annSend">ğŸ“¢ Broadcast</button>
            <button class="btn btn-ghost btn-sm" id="A_annClear">âœ• Clear</button>
          </div>
        </div>
        <div class="mc">
          <div class="mc-ttl">Quick Messages</div>
          <div id="quickMsgs" style="display:flex;gap:7px;flex-wrap:wrap;margin-top:4px"></div>
        </div>
        <div class="mc">
          <div class="mc-ttl">Manual Money Adjustment</div>
          <div id="moneyAdj"></div>
        </div>
        <!-- VIOLATION LOG: shows navigation violations from teams -->
        <div class="mc" style="border:1.5px solid rgba(220,38,38,.2);background:rgba(254,242,242,.5)">
          <div class="mc-ttl" style="color:#dc2626">âš  Navigation Violation Log</div>
          <div style="font-size:11px;color:#9AAFC7;margin-bottom:8px;font-weight:600">Teams that switch tabs/apps during betting or answering appear here in real-time.</div>
          <div id="viol-log" style="max-height:200px;overflow-y:auto"></div>
        </div>
      </div>

    </div><!-- /amain -->
  </div><!-- /a-body -->

  <div class="a-foot">
    <div style="font-size:10px;font-weight:700;letter-spacing:2px;color:var(--gray-mid);text-transform:uppercase">SUPPLY CHAIN  Auction Show Â· Admin</div>
    <div style="flex:1"></div>
    <button class="btn btn-outline btn-sm" id="A_sync">ğŸ”„ Sync</button>
  </div>
</div><!-- /admin -->

</div><!-- /app -->

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var FB_CONFIG = {
  apiKey: "AIzaSyCSyzYtCd-uiolBucZnncuIWpnE5mPG9Cs",
  authDomain: "logistics-auction-show.firebaseapp.com",
  databaseURL: "https://logistics-auction-show-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "logistics-auction-show",
  storageBucket: "logistics-auction-show.firebasestorage.app",
  messagingSenderId: "596983567254",
  appId: "1:596983567254:web:91f5b863db7464886503b7"
};
try { firebase.initializeApp(FB_CONFIG); } catch(e) { document.body.innerHTML='<div style="position:fixed;inset:0;background:#fff;color:#ef4444;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px;font-family:sans-serif;font-size:18px;z-index:9999"><div>âš  Firebase Error</div><div style="font-size:14px;color:#666">'+e.message+'</div></div>'; }
var DB = firebase.database();
var GREF = DB.ref('gameState');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEFAULT QUESTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var DEFAULT_Q = [
  {id:'q1',text:'What does ETA stand for in logistics?',options:['Estimated Time of Arrival','Electronic Tracking Agent','Express Transport Authorization','Enhanced Transit Algorithm'],correct:0},
  {id:'q2',text:'Which Incoterm means seller bears all risk until buyer destination?',options:['FOB Origin','CIF','EXW','DDP'],correct:3},
  {id:'q3',text:'What is a cross-dock operation?',options:['Loading cargo across borders','Transfer inbound to outbound without storage','A shared dock between warehouses','Overnight freight handling'],correct:1},
  {id:'q4',text:'What does 3PL stand for?',options:['Third-Party Logistics','Three-Point Loading','Triple Parcel Layer','Tri-Phase Logistics'],correct:0},
  {id:'q5',text:'Which technology uses radio waves to track inventory?',options:['GPS','NFC','RFID','Barcode'],correct:2},
  {id:'q6',text:'Which inventory method assumes first item received is first sold?',options:['LIFO','FIFO','JIT','ABC Analysis'],correct:1},
  {id:'q7',text:'What document is required for international ocean freight?',options:['Air Waybill','Bill of Lading','Packing Slip','Purchase Order'],correct:1},
  {id:'q8',text:'What is "last mile" delivery?',options:['Final 1-mile drive','Delivery from hub to end customer','International customs','Warehouse to port transport'],correct:1},
  {id:'q9',text:'Total time from order to customer delivery?',options:['Transit Time','Lead Time','Cycle Time','Processing Time'],correct:1},
  {id:'q10',text:'What does SKU stand for?',options:['Stock Keeping Unit','Supply Key Update','Store Knowledge Upload','Shipment Kit Utility'],correct:0}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function freshState() {
  return {
    phase: 'lobby', version: Date.now(),
    teams: [], questions: JSON.parse(JSON.stringify(DEFAULT_Q)),
    currentQuestionIndex: -1, activeTeam: null,
    timerDuration: 30, timerRemaining: 30, timerRunning: false, timerStartedAt: null,
    announcement: '', round: 0, bets: {},
    selectedAnswer: null, lastResult: null, winner: null, assignedDevices: []
  };
}
var ST = freshState();
var editTeams = [];
var adminReady = false;
var _autoJudged = false;

/* Currency: Indian Rupee */
function $m(v) { return 'â‚¹' + Number(v || 0).toLocaleString('en-IN'); }
function esc(s) { return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function clone(o) { return JSON.parse(JSON.stringify(o)); }
function upd(patch) { GREF.update(patch); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NOTIFICATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function notif(msg, type) {
  var el = document.getElementById('notif');
  el.textContent = msg;
  var map = {success:'ok', error:'err', info:'info'};
  el.className = 'show ' + (map[type] || 'info');
  clearTimeout(el._t);
  el._t = setTimeout(function() { el.className = (el.className || '').replace('show','').trim(); }, 3200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE LISTENER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GREF.on('value', function(snap) {
  var d = snap.val();
  if (!d) { ST = freshState(); GREF.set(ST); return; }
  ST = d;
  if (adminReady) onST(ST);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function doLogin() {
  var pw = document.getElementById('pw').value;
  if (pw === 'admin123') {
    document.getElementById('login').style.display = 'none';
    document.getElementById('admin').style.display = 'block';
    initAdmin();
  } else {
    document.getElementById('lerr').textContent = 'Wrong password';
    setTimeout(function() { document.getElementById('lerr').textContent = ''; }, 3000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHASE UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var PINFO = {
  lobby:     {l:'LOBBY',     c:'#1E90FF'},
  spin:      {l:'SPIN',      c:'#1E90FF'},
  betting:   {l:'BETTING',   c:'#E6B800'},
  answering: {l:'ANSWERING', c:'#1E90FF'},
  result:    {l:'RESULT',    c:'#1E90FF'},
  reveal:    {l:'CHAMPION',  c:'#E6B800'}
};
function updatePhaseUI(phase) {
  var info = PINFO[phase] || {l: phase.toUpperCase(), c: '#1E90FF'};
  document.getElementById('phasebar').style.background = info.c;
  document.getElementById('phase-lbl').textContent = info.l;
  var badge = document.getElementById('phase-badge');
  badge.style.background = info.c + '18';
  badge.style.borderColor = info.c + '44';
  badge.style.color = info.c;
  document.getElementById('pdot').style.background = info.c;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ON STATE CHANGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onST(st) {
  updatePhaseUI(st.phase);
  renderSidebar(st);
  renderLivePanel(st);
  renderQBank(st);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT ADMIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAdmin() {
  editTeams = ST.teams && ST.teams.length ? clone(ST.teams) : genDT(4);
  document.getElementById('teamCount').value = editTeams.length;
  document.getElementById('timerDef').value = ST.timerDuration || 30;
  renderTeamInputs();
  renderQBank(ST);
  renderSidebar(ST);
  renderLivePanel(ST);
  renderBroadcast();
  updatePhaseUI(ST.phase);
  adminReady = true;
  setInterval(timerTick, 250);

  // â”€â”€ NAVIGATION VIOLATION MONITOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Listen to Firebase violations node and alert admin in real-time
  DB.ref('gameState/violations').on('child_added', function(snap) {
    var v = snap.val(); if (!v) return;
    if (Date.now() - (v.timestamp || 0) > 30000) return; // ignore old
    showViolationAlert(v.teamName, new Date(v.timestamp).toLocaleTimeString());
  });
  DB.ref('gameState/violations').on('child_changed', function(snap) {
    var v = snap.val(); if (!v) return;
    if (Date.now() - (v.timestamp || 0) > 10000) return;
    showViolationAlert(v.teamName, new Date(v.timestamp).toLocaleTimeString());
  });
}
function genDT(n) {
  var arr = [];
  for (var i = 0; i < n; i++) arr.push({name: 'Team ' + (i+1), money: 10000, wins: 0, losses: 0});
  return arr;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEAM SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function genSlots() {
  var n = parseInt(document.getElementById('teamCount').value);
  if (isNaN(n) || n < 2 || n > 10) { notif('2-10 teams', 'error'); return; }
  while (editTeams.length < n) editTeams.push({name:'Team '+(editTeams.length+1),money:10000,wins:0,losses:0});
  editTeams = editTeams.slice(0, n);
  renderTeamInputs();
}
function renderTeamInputs() {
  var el = document.getElementById('teamInputs');
  var html = '';
  for (var i = 0; i < editTeams.length; i++) {
    var t = editTeams[i];
    html += '<div class="trow">' +
      '<span style="font-family:DM Mono,monospace;font-size:11px;color:var(--blue);min-width:24px;font-weight:500">' + (i+1) + '</span>' +
      '<input class="inp" type="text" value="' + esc(t.name) + '" data-tn="' + i + '" style="flex:2" placeholder="Team name">' +
      '<input class="inp" type="number" value="' + (t.money || 10000) + '" data-tm="' + i + '" style="width:110px">' +
      '<button class="btn btn-red btn-sm" data-td="' + i + '">âœ•</button>' +
      '</div>';
  }
  el.innerHTML = html;
  var tns = el.querySelectorAll('[data-tn]');
  for (var i = 0; i < tns.length; i++) {
    (function(elem) {
      elem.addEventListener('input', function() { editTeams[parseInt(elem.dataset.tn)].name = elem.value; });
    })(tns[i]);
  }
  var tms = el.querySelectorAll('[data-tm]');
  for (var i = 0; i < tms.length; i++) {
    (function(elem) {
      elem.addEventListener('input', function() { editTeams[parseInt(elem.dataset.tm)].money = parseInt(elem.value) || 0; });
    })(tms[i]);
  }
  var tds = el.querySelectorAll('[data-td]');
  for (var i = 0; i < tds.length; i++) {
    (function(elem) {
      elem.addEventListener('click', function() {
        editTeams.splice(parseInt(elem.dataset.td), 1);
        document.getElementById('teamCount').value = editTeams.length;
        renderTeamInputs();
      });
    })(tds[i]);
  }
}
function applyAll() {
  var v = parseInt(document.getElementById('allMoney').value);
  if (isNaN(v) || v < 0) { notif('Invalid amount', 'error'); return; }
  for (var i = 0; i < editTeams.length; i++) editTeams[i].money = v;
  renderTeamInputs();
  notif('Applied!', 'success');
}
function saveSetup() {
  var tns = document.querySelectorAll('[data-tn]');
  for (var i = 0; i < tns.length; i++) editTeams[parseInt(tns[i].dataset.tn)].name = tns[i].value.trim() || 'Team '+(parseInt(tns[i].dataset.tn)+1);
  var tms = document.querySelectorAll('[data-tm]');
  for (var i = 0; i < tms.length; i++) editTeams[parseInt(tms[i].dataset.tm)].money = parseInt(tms[i].value) || 0;
  if (editTeams.length < 2) { notif('Need 2+ teams', 'error'); return; }
  var names = editTeams.map(function(t) { return t.name; });
  var uniq = {};
  for (var i = 0; i < names.length; i++) { if (uniq[names[i]]) { notif('Duplicate names!', 'error'); return; } uniq[names[i]] = 1; }
  var td = parseInt(document.getElementById('timerDef').value) || 30;
  upd({teams: clone(editTeams), timerDuration: td, timerRemaining: td});
  notif('Config saved!', 'success');
  document.getElementById('setupMsg').innerHTML = '<span style="color:var(--green)">âœ… ' + editTeams.length + ' Teams Saved</span>';
}
function startShow() {
  if (!ST.teams || ST.teams.length < 2) { notif('Save config first!', 'error'); return; }
  upd({phase: 'spin', assignedDevices: [], announcement: 'ğŸ¬ SHOW STARTING! betting to spin and join!'});
  notif('Show started!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUESTION BANK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQBank(st) {
  var qs = Array.isArray(st.questions) ? st.questions : [];
  var sel = document.getElementById('qSelect');
  if (sel) {
    var opts = '<option value="-1">â€” Choose question â€”</option>';
    for (var i = 0; i < qs.length; i++) {
      var q = qs[i];
      var txt = q.text.length > 48 ? q.text.substr(0, 48) + '...' : q.text;
      opts += '<option value="' + i + '"' + (st.currentQuestionIndex === i ? ' selected' : '') + '>Q' + (i+1) + ': ' + esc(txt) + '</option>';
    }
    sel.innerHTML = opts;
  }
  var el = document.getElementById('qBank');
  if (!el) return;
  var html = '';
  for (var i = 0; i < qs.length; i++) {
    var q = qs[i];
    html += '<div class="qcard ' + (st.currentQuestionIndex === i ? 'sel' : '') + '" id="qcard-' + i + '">';
    html += '<div class="qhdr"><span class="qnl">Q' + (i+1) + '</span><div class="qtext">' + esc(q.text) + '</div>';
    html += '<button style="border:none;background:transparent;cursor:pointer;color:var(--gray-mid);font-size:15px;padding:4px;border-radius:4px" data-qe="' + i + '" title="Edit">âœ</button>';
    html += '<button style="border:none;background:transparent;cursor:pointer;color:var(--red);font-size:15px;padding:4px;border-radius:4px;opacity:.5" data-qd="' + i + '" title="Delete">ğŸ—‘</button>';
    html += '</div>';
    html += '<div class="qbody" id="qbody-' + i + '">';
    html += '<div style="margin-bottom:10px"><label class="lbl">Question</label><textarea class="inp" id="qt-' + i + '" rows="2">' + esc(q.text) + '</textarea></div>';
    html += '<div style="margin-bottom:10px"><label class="lbl">Options (click â— = correct answer)</label>';
    var letters = ['A','B','C','D'];
    for (var j = 0; j < q.options.length; j++) {
      html += '<div class="qorow">';
      html += '<span style="font-family:DM Mono,monospace;font-size:10px;color:var(--blue);min-width:18px;font-weight:500">' + letters[j] + '</span>';
      html += '<input class="inp" id="qo-' + i + '-' + j + '" value="' + esc(q.options[j]) + '" style="flex:1">';
      html += '<div class="cdot ' + (q.correct === j ? 'on' : '') + '" data-qi="' + i + '" data-qj="' + j + '">' + (q.correct === j ? 'âœ“' : '') + '</div>';
      html += '</div>';
    }
    html += '</div>';
    html += '<div style="display:flex;gap:8px"><button class="btn btn-green btn-sm" data-qs="' + i + '">ğŸ’¾ Save</button><button class="btn btn-ghost btn-sm" data-qc="' + i + '">âœ• Cancel</button></div>';
    html += '</div></div>';
  }
  el.innerHTML = html;
  var qes = el.querySelectorAll('[data-qe]');
  for (var i = 0; i < qes.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() {
        var body = document.getElementById('qbody-' + btn.dataset.qe);
        if (body) body.classList.toggle('open');
      });
    })(qes[i]);
  }
  var qds = el.querySelectorAll('[data-qd]');
  for (var i = 0; i < qds.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() {
        if (!confirm('Delete this question?')) return;
        var qs2 = clone(ST.questions || []);
        qs2.splice(parseInt(btn.dataset.qd), 1);
        upd({questions: qs2, currentQuestionIndex: -1});
        notif('Deleted', 'info');
      });
    })(qds[i]);
  }
  var qss = el.querySelectorAll('[data-qs]');
  for (var i = 0; i < qss.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() { saveQ(parseInt(btn.dataset.qs)); });
    })(qss[i]);
  }
  var qcs = el.querySelectorAll('[data-qc]');
  for (var i = 0; i < qcs.length; i++) {
    (function(btn) {
      btn.addEventListener('click', function() {
        var body = document.getElementById('qbody-' + btn.dataset.qc);
        if (body) body.classList.remove('open');
      });
    })(qcs[i]);
  }
  var cdots = el.querySelectorAll('.cdot');
  for (var i = 0; i < cdots.length; i++) {
    (function(dot) {
      dot.addEventListener('click', function() {
        var qs2 = clone(ST.questions || []);
        var qi = parseInt(dot.dataset.qi);
        if (qs2[qi]) qs2[qi].correct = parseInt(dot.dataset.qj);
        upd({questions: qs2});
        notif('Correct answer set', 'success');
      });
    })(cdots[i]);
  }
}
function saveQ(i) {
  var qs = clone(ST.questions || []);
  if (!qs[i]) return;
  var qt = document.getElementById('qt-' + i);
  if (qt) qs[i].text = qt.value.trim() || qs[i].text;
  for (var j = 0; j < 4; j++) {
    var e = document.getElementById('qo-' + i + '-' + j);
    if (e) qs[i].options[j] = e.value.trim();
  }
  upd({questions: qs});
  notif('Question saved!', 'success');
  var body = document.getElementById('qbody-' + i);
  if (body) body.classList.remove('open');
}
function addQ() {
  var qs = clone(Array.isArray(ST.questions) ? ST.questions : []);
  qs.push({id:'q_'+Date.now(),text:'New question â€” click âœ to edit',options:['Option A','Option B','Option C','Option D'],correct:0});
  upd({questions: qs});
  notif('Question added', 'success');
  setTimeout(function() {
    var body = document.getElementById('qbody-' + (qs.length - 1));
    if (body) body.classList.add('open');
  }, 200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIDEBAR RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSidebar(st) {
  var sorted = (st.teams || []).slice().sort(function(a,b) { return b.money - a.money; });
  var lbHtml = '';
  for (var i = 0; i < sorted.length; i++) {
    var t = sorted[i];
    lbHtml += '<div class="lbr ' + (st.activeTeam === t.name ? 'at' : '') + '">' +
      '<span style="font-family:DM Mono,monospace;font-size:11px;color:var(--gray-mid);min-width:24px">' + (i===0?'ğŸ¥‡':'#'+(i+1)) + '</span>' +
      '<span style="flex:1;font-size:13px;font-weight:600">' + esc(t.name) + '</span>' +
      '<span style="font-family:DM Mono,monospace;font-size:11px;color:' + (i===0?'var(--gold-deep)':'var(--blue)') + ';font-weight:500">' + $m(t.money) + '</span></div>';
  }
  document.getElementById('S_lb').innerHTML = lbHtml;
  var betsHtml = '';
  var teams = st.teams || [];
  for (var i = 0; i < teams.length; i++) {
    var t = teams[i];
    var b = st.bets && st.bets[t.name];
    betsHtml += '<div class="betr ' + (b ? 'hb' : '') + '">' +
      '<span style="font-size:13px;font-weight:600">' + esc(t.name) + '</span>' +
      (b ? '<span style="font-family:DM Mono,monospace;font-size:11px;color:var(--gold-deep);font-weight:500">' + $m(b) + '</span>'
         : '<span style="color:var(--gray-mid);font-size:11px">â€”</span>') +
      '</div>';
  }
  document.getElementById('S_bets').innerHTML = betsHtml;
  var qs = Array.isArray(st.questions) ? st.questions : [];
  var q = st.currentQuestionIndex >= 0 ? qs[st.currentQuestionIndex] : null;
  document.getElementById('S_q').textContent = q ? ('Q' + (st.currentQuestionIndex+1) + ': ' + q.text) : 'None selected';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIVE PANEL RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderLivePanel(st) {
  var qs = Array.isArray(st.questions) ? st.questions : [];
  var tal = document.getElementById('teamActList');
  if (tal) {
    var html = '';
    var teams = st.teams || [];
    for (var i = 0; i < teams.length; i++) {
      var t = teams[i];
      var bet = st.bets && st.bets[t.name];
      var on = st.activeTeam === t.name;
      html += '<button class="act-btn ' + (on ? 'on' : '') + '" data-act="' + esc(t.name) + '">' +
        '<div><div style="font-size:14px;font-weight:700;' + (on ? 'color:var(--blue)' : '') + '">' + esc(t.name) + '</div>' +
        '<div style="font-size:11px;color:var(--gray-mid)">' + $m(t.money) + ' Â· W:' + (t.wins||0) + ' L:' + (t.losses||0) + (bet ? ' Â· Bet:' + $m(bet) : ' Â· no bet') + '</div></div>' +
        '<span style="font-size:16px">' + (on ? 'âš¡' : 'â—‹') + '</span></button>';
    }
    tal.innerHTML = html;
    var acts = tal.querySelectorAll('[data-act]');
    for (var i = 0; i < acts.length; i++) {
      (function(btn) {
        btn.addEventListener('click', function() { activateTeam(btn.dataset.act); });
      })(acts[i]);
    }
  }
  var ad = document.getElementById('ansDisplay');
  if (ad) {
    if (st.selectedAnswer !== null && st.selectedAnswer !== undefined && st.currentQuestionIndex >= 0) {
      var q = qs[st.currentQuestionIndex];
      var ltr = 'ABCD'[st.selectedAnswer];
      var optTxt = q ? q.options[st.selectedAnswer] : '';
      ad.innerHTML = '<div style="display:flex;align-items:center;gap:12px;width:100%">' +
        '<span style="font-family:DM Mono,monospace;font-size:20px;color:var(--gold-deep)">[' + ltr + ']</span>' +
        '<span style="flex:1;font-size:15px;font-weight:600">' + esc(optTxt) + '</span>' +
        '<span style="font-size:11px;color:var(--gray-mid)">â€” ' + esc(st.activeTeam || '?') + '</span></div>';
      document.getElementById('A_correct').disabled = false;
      document.getElementById('A_wrong').disabled = false;
    } else {
      ad.innerHTML = 'â³ Waiting for team answer...';
      document.getElementById('A_correct').disabled = true;
      document.getElementById('A_wrong').disabled = true;
    }
  }
  var ma = document.getElementById('moneyAdj');
  if (ma) {
    var html = '';
    var teams = st.teams || [];
    for (var i = 0; i < teams.length; i++) {
      var t = teams[i];
      html += '<div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">' +
        '<span style="font-size:14px;font-weight:700;min-width:110px">' + esc(t.name) + '</span>' +
        '<span style="font-family:DM Mono,monospace;font-size:12px;color:var(--gold-deep);min-width:80px">' + $m(t.money) + '</span>' +
        '<input class="inp" type="number" data-mai="' + i + '" placeholder="Â±amount" style="width:100px">' +
        '<button class="btn btn-outline btn-sm" data-maa="' + i + '">Apply</button></div>';
    }
    ma.innerHTML = html;
    var maas = ma.querySelectorAll('[data-maa]');
    for (var i = 0; i < maas.length; i++) {
      (function(btn) {
        btn.addEventListener('click', function() {
          var idx = parseInt(btn.dataset.maa);
          var inp = ma.querySelector('[data-mai="' + idx + '"]');
          if (!inp) return;
          var v = parseInt(inp.value);
          if (isNaN(v)) { notif('Invalid amount', 'error'); return; }
          var teams2 = clone(ST.teams);
          if (!teams2[idx]) return;
          teams2[idx].money = Math.max(0, teams2[idx].money + v);
          upd({teams: teams2});
          inp.value = '';
          notif(teams2[idx].name + ': ' + (v >= 0 ? '+' : '') + $m(v), 'info');
        });
      })(maas[i]);
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BROADCAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBroadcast() {
  var QM = [
    ['ğŸ¬ Welcome', 'ğŸ¬ Welcome to the SUPPLY CHAIN Auction Show!'],
    ['ğŸ’° Bet Open', 'ğŸ’° Betting OPEN â€” read the question and place your bets!'],
    ['ğŸ”’ Reveal', 'ğŸ”’ Betting closed! Options revealed â€” answer now!'],
    ['â± Timer', 'â± Timer starting â€” good luck!'],
    ['â­ Next Q', 'â­ Next question loading â€” get ready!'],
    ['âš  Break', 'âš  Short break â€” please stand by...']
  ];
  var html = '';
  for (var i = 0; i < QM.length; i++) html += '<button class="btn btn-outline btn-sm" data-qmi="' + i + '">' + QM[i][0] + '</button>';
  var el = document.getElementById('quickMsgs');
  el.innerHTML = html;
  var btns = el.querySelectorAll('[data-qmi]');
  for (var i = 0; i < btns.length; i++) {
    (function(btn, msgs) {
      btn.addEventListener('click', function() {
        document.getElementById('annInput').value = msgs[parseInt(btn.dataset.qmi)][1];
        sendAnn();
      });
    })(btns[i], QM);
  }
}
function sendAnn() {
  var m = document.getElementById('annInput').value.trim();
  if (!m) { notif('Enter a message', 'error'); return; }
  upd({announcement: m});
  notif('Broadcast sent!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setQ() {
  var idx = parseInt(document.getElementById('qSelect').value);
  if (idx < 0) { notif('Choose a question first', 'error'); return; }
  upd({currentQuestionIndex: idx, selectedAnswer: null, lastResult: null, bets: {}});
  notif('Q' + (idx+1) + ' loaded', 'success');
}
function openBetting() {
  if (ST.currentQuestionIndex < 0) { notif('Select a question first!', 'error'); return; }
  upd({phase: 'betting', bets: {}, selectedAnswer: null, lastResult: null,
    timerRunning: false, timerRemaining: ST.timerDuration, timerStartedAt: null,
    announcement: 'ğŸ’° BETTING OPEN â€” Read question and place bets! Options hidden.'});
  notif('ğŸ’° Betting opened!', 'success');
}
function closeBetting() {
  upd({phase: 'answering', announcement: 'ğŸ”’ Betting closed! Options now REVEALED!'});
  notif('Options revealed â†’ Answering', 'info');
}
function activateTeam(name) {
  upd({activeTeam: name, selectedAnswer: null, phase: 'answering', announcement: 'âš¡ ' + name + ' is now answering!'});
  notif('âš¡ ' + name + ' activated', 'info');
}
function startTimer() {
  var ov = parseInt(document.getElementById('timerOvr').value);
  var dur = isNaN(ov) || ov < 1 ? (ST.timerDuration || 30) : Math.min(120, Math.max(1, ov));
  upd({timerDuration: dur, timerRemaining: dur, timerRunning: true, timerStartedAt: Date.now()});
  document.getElementById('timerOvr').value = '';
  notif('Timer: ' + dur + 's started', 'info');
}
function stopTimer() {
  var rem = ST.timerRemaining || 0;
  if (ST.timerRunning && ST.timerStartedAt) rem = Math.max(0, (ST.timerRemaining || 0) - (Date.now() - ST.timerStartedAt) / 1000);
  upd({timerRunning: false, timerRemaining: rem, timerStartedAt: null});
  notif('Timer stopped', 'info');
}
function resetTimer() {
  upd({timerRunning: false, timerRemaining: ST.timerDuration || 30, timerStartedAt: null});
  notif('Timer reset', 'info');
}
function timerTick() {
  if (!adminReady) return;
  var rem = ST.timerRemaining || 0;
  if (ST.timerRunning && ST.timerStartedAt) rem = Math.max(0, (ST.timerRemaining || 0) - (Date.now() - ST.timerStartedAt) / 1000);
  var s = Math.ceil(rem);
  var el = document.getElementById('S_timer');
  if (el) {
    el.textContent = s > 0 ? (s < 10 ? '0' + s : '' + s) : '00';
    el.className = 'tbig' + (s <= 3 && s > 0 ? ' dang' : s <= 5 && s > 0 ? ' warn' : '');
  }
  var ts = document.getElementById('S_tstatus');
  if (ts) { ts.textContent = ST.timerRunning ? 'â— Running' : 'â–  Stopped'; ts.style.color = ST.timerRunning ? 'var(--blue)' : 'var(--gray-mid)'; }
  if (rem <= 0 && ST.timerRunning && !_autoJudged && ST.phase === 'answering' && ST.activeTeam) {
    _autoJudged = true;
    upd({timerRunning: false, timerRemaining: 0, timerStartedAt: null});
    autoTimeout();
  }
  if (rem > 0) _autoJudged = false;
}
function autoTimeout() {
  var teams = clone(ST.teams || []);
  var ti = -1;
  for (var i = 0; i < teams.length; i++) { if (teams[i].name === ST.activeTeam) { ti = i; break; } }
  if (ti < 0) return;
  var bet = ST.bets && ST.bets[ST.activeTeam] ? parseInt(ST.bets[ST.activeTeam]) : 0;
  teams[ti].money = Math.max(0, teams[ti].money - bet);
  teams[ti].losses = (teams[ti].losses || 0) + 1;
  upd({teams: teams, phase: 'result', timerRunning: false, timerStartedAt: null,
    lastResult: {teamName: ST.activeTeam, correct: false, betAmount: bet, timestamp: Date.now(), timeout: true},
    announcement: "â° TIME'S UP! " + ST.activeTeam + " ran out of time!"});
  notif('Timeout!', 'error');
}
function judgeAnswer(correct) {
  if (ST.selectedAnswer === null || ST.selectedAnswer === undefined) { notif('No answer yet', 'error'); return; }
  if (!ST.activeTeam) { notif('No active team', 'error'); return; }
  var teams = clone(ST.teams || []);
  var ti = -1;
  for (var i = 0; i < teams.length; i++) { if (teams[i].name === ST.activeTeam) { ti = i; break; } }
  if (ti < 0) return;
  var team = teams[ti];
  var bet = ST.bets && ST.bets[ST.activeTeam] ? parseInt(ST.bets[ST.activeTeam]) : 0;
  if (correct) { team.money += bet; team.wins = (team.wins || 0) + 1; }
  else { team.money = Math.max(0, team.money - bet); team.losses = (team.losses || 0) + 1; }
  upd({teams: teams, phase: 'result', timerRunning: false, timerStartedAt: null,
    lastResult: {teamName: ST.activeTeam, correct: correct, betAmount: bet, timestamp: Date.now()},
    announcement: correct ? 'âœ… ' + ST.activeTeam + ' CORRECT! +' + $m(bet) : 'âŒ ' + ST.activeTeam + ' WRONG! -' + $m(bet)});
  notif(correct ? 'CORRECT +' + $m(bet) : 'WRONG -' + $m(bet), correct ? 'success' : 'error');
}
function nextQ() {
  upd({phase: 'betting', activeTeam: null, selectedAnswer: null, lastResult: null,
    bets: {}, timerRunning: false, timerRemaining: ST.timerDuration || 30, timerStartedAt: null,
    round: (ST.round || 0) + 1, announcement: 'â­ Next question loading â€” get ready to bet!'});
  notif('Next question', 'info');
}
function endGame() {
  if (!ST.teams || !ST.teams.length) { notif('No teams', 'error'); return; }
  if (!confirm('End show and reveal winner?')) return;
  var winner = (ST.teams || []).slice().sort(function(a,b) { return b.money - a.money; })[0];
  upd({phase: 'reveal', winner: winner, timerRunning: false, timerStartedAt: null,
    announcement: 'ğŸ† ' + winner.name + ' WINS THE SUPPLY CHAIN AUCTION SHOW!'});
  notif('ğŸ† ' + winner.name + ' WINS!', 'success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION VIOLATION ALERT
// Displays popup in admin panel when team switches tabs during game
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  // Inject violation alert styles
  var vstyle = document.createElement('style');
  vstyle.textContent = `
    #viol-container { position:fixed; top:70px; right:20px; z-index:9900; display:flex; flex-direction:column; gap:8px; max-width:340px; }
    .viol-alert { background:#fff; border:2px solid #dc2626; border-radius:10px; padding:14px 16px; box-shadow:0 4px 20px rgba(220,38,38,.25); animation:violIn .35s cubic-bezier(.22,1,.36,1) both; }
    @keyframes violIn { from{opacity:0;transform:translateX(40px)} to{opacity:1;transform:translateX(0)} }
    .viol-title { font-size:11px; font-weight:800; letter-spacing:2px; color:#dc2626; text-transform:uppercase; margin-bottom:6px; }
    .viol-body { font-size:14px; font-weight:700; color:#1A2B42; }
    .viol-time { font-size:11px; color:#9AAFC7; font-weight:600; margin-top:4px; }
    .viol-close { float:right; border:none; background:transparent; cursor:pointer; color:#9AAFC7; font-size:16px; line-height:1; margin-left:8px; }
    #viol-log { padding:0; margin:0; }
    .viol-log-entry { padding:8px 10px; border-radius:6px; background:#fff5f5; border:1px solid rgba(220,38,38,.2); margin-bottom:6px; font-size:13px; font-weight:600; color:#7f1d1d; }
  `;
  document.head.appendChild(vstyle);

  // Container for floating alerts
  var vc = document.createElement('div');
  vc.id = 'viol-container';
  document.body.appendChild(vc);
})();

function showViolationAlert(teamName, timeStr) {
  // Show floating popup
  var vc = document.getElementById('viol-container');
  if (!vc) return;
  var card = document.createElement('div');
  card.className = 'viol-alert';
  card.innerHTML =
    '<button class="viol-close" onclick="this.parentElement.remove()">âœ•</button>' +
    '<div class="viol-title">âš  Navigation Violation</div>' +
    '<div class="viol-body">Team: <span style="color:#dc2626">' + (teamName || 'Unknown') + '</span></div>' +
    '<div class="viol-time">' + (timeStr || '') + ' â€” switched tab/app during game</div>';
  vc.appendChild(card);
  // Auto-remove after 15 seconds
  setTimeout(function() { if(card.parentElement) card.remove(); }, 15000);

  // Also append to log if visible in broadcast tab
  var logEl = document.getElementById('viol-log');
  if (logEl) {
    var entry = document.createElement('div');
    entry.className = 'viol-log-entry';
    entry.textContent = 'âš  ' + (teamName || '?') + ' â€” ' + (timeStr || '') + ' â€” Navigation Violation';
    logEl.prepend(entry);
  }
  notif('âš  Violation: ' + (teamName || 'Unknown'), 'error');
}

// WIRE ALL BUTTONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  document.getElementById('L_btn').addEventListener('click', doLogin);
  document.getElementById('pw').addEventListener('keydown', function(e) { if (e.key === 'Enter') doLogin(); });
  document.getElementById('A_display').addEventListener('click', function() { window.open('index.html', '_blank'); });
  document.getElementById('A_reset').addEventListener('click', function() {
    if (!confirm('Full reset? All team assignments and progress will be cleared.')) return;
    editTeams = genDT(4);
    document.getElementById('teamCount').value = 4;
    renderTeamInputs();
    var resetState = freshState();
    resetState.version = Date.now();
    for (var i = 0; i < resetState.teams.length; i++) resetState.teams[i].deviceId = null;
    GREF.set(resetState);
    notif('Reset complete â€” all devices can spin again', 'info');
  });
  document.getElementById('A_sync').addEventListener('click', function() { upd({_sync: Date.now()}); notif('Synced!', 'success'); });
  document.getElementById('A_gen').addEventListener('click', genSlots);
  document.getElementById('A_allMoney').addEventListener('click', applyAll);
  document.getElementById('A_save').addEventListener('click', saveSetup);
  document.getElementById('A_start').addEventListener('click', startShow);
  document.getElementById('A_addQ').addEventListener('click', addQ);
  document.getElementById('A_setQ').addEventListener('click', setQ);
  document.getElementById('A_openBet').addEventListener('click', openBetting);
  document.getElementById('A_closeBet').addEventListener('click', closeBetting);
  document.getElementById('A_timerStart').addEventListener('click', startTimer);
  document.getElementById('A_timerStop').addEventListener('click', stopTimer);
  document.getElementById('A_timerReset').addEventListener('click', resetTimer);
  document.getElementById('A_correct').addEventListener('click', function() { judgeAnswer(true); });
  document.getElementById('A_wrong').addEventListener('click', function() { judgeAnswer(false); });
  document.getElementById('A_nextQ').addEventListener('click', nextQ);
  document.getElementById('A_endGame').addEventListener('click', endGame);
  document.getElementById('A_annSend').addEventListener('click', sendAnn);
  document.getElementById('A_annClear').addEventListener('click', function() { upd({announcement: ''}); document.getElementById('annInput').value = ''; });
  var tabs = document.querySelectorAll('.tab');
  for (var i = 0; i < tabs.length; i++) {
    (function(tab) {
      tab.addEventListener('click', function() {
        var all = document.querySelectorAll('.tab');
        for (var j = 0; j < all.length; j++) all[j].classList.remove('on');
        var panels = document.querySelectorAll('.tabp');
        for (var j = 0; j < panels.length; j++) panels[j].classList.remove('on');
        tab.classList.add('on');
        var panel = document.getElementById('tabp-' + tab.dataset.t);
        if (panel) panel.classList.add('on');
      });
    })(tabs[i]);
  }
})();
</script>
</body>
</html>
